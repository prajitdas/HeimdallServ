d3.selection.prototype.moveToFront=function(){return this.each(function(){this.parentNode.appendChild(this)})},SEL_CLUSTER=null,SEL_NODE=null,MAL_CLUSTER=null,MAL_NODE=null,BEN_CLUSTER=null,BEN_NODE=null;var width=$("#container").width(),height=$("#container").height(),padding=1.5,clusterPadding=6,maxRadius=12;radius=6,d3.json("clusters.json",function(t,e){function n(t){y.each(i(10*t.alpha*t.alpha)).each(a(.5)).attr("cx",function(t){return t.x}).attr("cy",function(t){return t.y}),d3.select("#"+appID).moveToFront(),d3.select("#"+appID).attr("r",4*radius)}function r(t){$("#clusterinfo").text("Cluster: "+t.cluster),$("#nameinfo").text("App Name: "+t.appName),window.open("https://play.google.com/store/apps/details?id="+t.appName.replace(/-/g,"."),"_blank")}function l(t,e){var n=$("#"+t).attr("cx"),r=$("#"+t).attr("cy"),l=$("#"+e).attr("cx"),i=$("#"+e).attr("cy"),a=[{x:l,y:i},{x:n,y:r}];f.append("path").attr("d",L(a)).attr("id","line"+e).attr("stroke","black").attr("stroke-width",5)}function i(t){return function(e){var n=E[e.cluster];if(n!==e){var r=e.x-n.x,l=e.y-n.y,i=Math.sqrt(r*r+l*l),a=e.radius+n.radius;i!=a&&(i=(i-a)/i*t,e.x-=r*=i,e.y-=l*=i,n.x+=r,n.y+=l)}}}function a(t){var e=d3.geom.quadtree(nodes);return function(n){var r=n.radius+maxRadius+Math.max(padding,clusterPadding),l=n.x-r,i=n.x+r,a=n.y-r,s=n.y+r;e.visit(function(e,r,o,u,c){if(e.point&&e.point!==n){var d=n.x-e.point.x,p=n.y-e.point.y,E=Math.sqrt(d*d+p*p),f=n.radius+e.point.radius+(n.cluster===e.point.cluster?padding:clusterPadding);f>E&&(E=(E-f)/E*t,n.x-=d*=E,n.y-=p*=E,e.point.x+=d,e.point.y+=p)}return r>i||l>u||o>s||a>c})}}var s=e.Loop100[0],o=JSON.parse(e.Loop100[3].centroids).shape[0],u=[];for(var c in s)u.push({cluster:s[c],appName:c.replace(/\./g,"-"),radius:radius});var d=$("#highlightoptions");numNodes=2e3,nodes=u.splice(0,numNodes),$.each(nodes,function(){d.append($("<option />").val(this.appName).text(this.appName))});nodes.length;nodes=nodes.sort(function(t,e){return t.cluster-e.cluster});for(var p=d3.scale.category20().domain(d3.range(o)),E=new Array(o),c=0;c<nodes.length;c++)E[nodes[c].cluster]||(E[nodes[c].cluster]=nodes[c]);d3.layout.pack().sort(null).size([width,height]).children(function(t){return t.values}).value(function(t){return t.radius*t.radius}).nodes({values:d3.nest().key(function(t){return t.cluster}).entries(nodes)});var f=(d3.layout.force().nodes(nodes).size([width,height]).gravity(.02).charge(0).on("tick",n).start(),d3.select("#container").append("svg").attr("width",width).attr("height",height)),h=d3.select("body").append("div").style("position","absolute").style("z-index","10").style("background-color","black").style("color","white").style("visibility","hidden").style("padding","2px").style("border-radius","4px").text("a simple tooltip"),y=f.selectAll("circle").data(nodes).enter().append("circle").style("fill",function(t){return p(t.cluster)}).attr("class",function(t){return"c"+t.cluster}).attr("id",function(t){return t.appName}).on("click",function(t){r(t),d3.select(this).moveToFront().style("fill",function(t){return p(t.cluster)})}).on("mouseover",function(t){return h.text("Cluster: "+t.cluster+"\nApp: "+t.appName),f.selectAll(".c"+t.cluster).style("fill","yellow"),h.style("visibility","visible")}).on("mousemove",function(){return h.style("top",event.pageY-10+"px").style("left",event.pageX+10+"px")}).on("mouseout",function(t){return f.selectAll(".c"+t.cluster).style("fill",function(t){return p(t.cluster)}),h.style("visibility","hidden")});y.transition().duration(750).delay(function(t,e){return 5*e}).attrTween("r",function(t){if(t.appName!=appID){var e=d3.interpolate(0,t.radius);return function(n){return t.radius=e(n)}}});var L=d3.svg.line().x(function(t){return t.x}).y(function(t){return t.y}).interpolate("linear");$("#highlight").click(function(){null!=SEL_NODE&&SEL_NODE.attr("r",radius).attr("stroke","none");var t=$("#highlightoptions").val(),e=d3.select("#"+t),n=e.attr("class"),r=d3.selectAll("."+n).style("fill");SEL_CLUSTER=n,SEL_NODE=e,d3.selectAll("."+n).style("fill","yellow"),setTimeout(function(){d3.selectAll("."+n).style("fill",r),setTimeout(function(){d3.selectAll("."+n).style("fill","yellow"),setTimeout(function(){d3.selectAll("."+n).style("fill",r)},500)},500)},500),e.moveToFront(),e.attr("r",4*radius).attr("stroke","black")}),$("#tagMalicious").click(function(){null!=SEL_CLUSTER&&(null!=MAL_CLUSTER&&(d3.selectAll("."+MAL_CLUSTER).style("fill",function(t){return p(t.cluster)}).attr("stroke","none"),d3.select("#line"+MAL_NODE.attr("id")).remove()),MAL_CLUSTER=SEL_CLUSTER,MAL_NODE=SEL_NODE,SEL_NODE.attr("r",radius).attr("stroke","none"),d3.selectAll("."+SEL_CLUSTER).style("fill","red").attr("stroke-width",3).attr("stroke","black"),SEL_CLUSTER=null,SEL_NODE=null,l(appID,MAL_NODE.attr("id")))}),$("#tagBenign").click(function(){null!=SEL_CLUSTER&&(null!=BEN_CLUSTER&&(d3.selectAll("."+BEN_CLUSTER).style("fill",function(t){return p(t.cluster)}).attr("stroke","none"),d3.select("#line"+BEN_NODE.attr("id")).remove()),BEN_CLUSTER=SEL_CLUSTER,BEN_NODE=SEL_NODE,SEL_NODE.attr("r",radius).attr("stroke","none"),d3.selectAll("."+SEL_CLUSTER).style("fill","green").attr("stroke-width",3).attr("stroke","black"),SEL_CLUSTER=null,SEL_NODE=null,l(appID,BEN_NODE.attr("id")))})}),setTimeout(function(){d3.select("#"+appID).attr("r",4*radius).attr("stroke","black").attr("stroke-width",2)},1e3);